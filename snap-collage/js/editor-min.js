"use strict";var Editor=function t(){this._elTrayImages=document.getElementById("tray-images"),this._collage=new Collage,this._elCollageFrame=this._collage._elCollage.parentElement,this._elCollageScrollContainer=document.getElementById("collage-scroll-container"),this._wasDraggedFromTray,this._elCanvasSize=document.getElementById("canvas-size"),this._elToolbarLayouts=document.getElementById("toolbar-layouts")};Editor.prototype.initialise=function(){var e=this;this.fitCollage(),window.addEventListener("resize",this.fitCollage.bind(this)),this._elTrayImages.querySelectorAll(".gallery-image").forEach(function(t){t.addEventListener("dragstart",e.onTrayImageDragstart.bind(e))}),this._elCollageFrame.addEventListener("dragover",this.onCollageDragover.bind(this)),this._collage._elCollage.addEventListener("dragover",this.onCollageDragover.bind(this)),this._elCollageFrame.addEventListener("drop",this.onCollageDrop.bind(this)),this._collage._elCollage.querySelectorAll(".photo").forEach(function(t){t.addEventListener("dragstart",e.onCollageImageDragstart.bind(e))}),this._collage._elCollage.querySelectorAll(".photo").forEach(function(t){t.addEventListener("dragover",e.onCollageImageDragover.bind(e))}),this._collage._elCollage.querySelectorAll(".photo").forEach(function(t){t.addEventListener("drop",e.onCollageImageDrop.bind(e))}),this._elTrayImages.addEventListener("dragover",this.onTrayDragover.bind(this)),this._elTrayImages.addEventListener("drop",this.onTrayDrop.bind(this)),document.addEventListener("dragleave",this.onDragleave.bind(this)),document.addEventListener("dragend",this.onDragend.bind(this)),this.updateToolbarLayouts(),this._elToolbarLayouts.querySelectorAll(".button").forEach(function(t){t.addEventListener("click",e.onLayoutButtonClick.bind(e))})},Editor.prototype.fitCollage=function(){this._collage.setScale(1);var t=(this._elCollageScrollContainer.clientWidth-40)/this._elCollageFrame.scrollHeight,e=(this._elCollageScrollContainer.clientHeight-40)/this._elCollageFrame.scrollHeight,a=Math.min(t,e);this._collage.setScale(a),this._elCanvasSize.textContent=Math.round(100*a).toString()+"%"},Editor.prototype.updateToolbarLayouts=function(){for(var t=Array.from(this._elToolbarLayouts.children),e=0;e<t.length;e++){var a;t[e].style.display="none"}if(2<=this._collage._nPhotos){var o=this._elToolbarLayouts.querySelector(".photos-"+this._collage._nPhotos.toString());this._updateActiveLayout(o),o.style.display="block"}},Editor.prototype._updateActiveLayout=function(t){for(var e=Array.from(t.children),a=0;a<e.length;a++){var o;e[a].classList.remove("active")}t.children[this._collage.getCurrentLayout()].classList.add("active")},Editor.prototype.onLayoutButtonClick=function(t){var e=Array.from(t.target.parentElement.children).indexOf(t.target);this._collage.setLayout(e),this._updateActiveLayout(t.target.parentElement)},Editor.prototype.onTrayImageDragstart=function(t){t.dataTransfer.setData("text/uri-list",t.target.src),this._wasDraggedFromTray=!0,this._elCollageFrame.setAttribute("droppable","true"),document.body.classList.add("dragging")},Editor.prototype.onCollageDragover=function(t){t.preventDefault(),this._wasDraggedFromTray&&this._elCollageFrame.classList.add("active-drop-target")},Editor.prototype.onCollageDrop=function(t){if(t.preventDefault(),this._wasDraggedFromTray){var e=t.dataTransfer.getData("text/uri-list"),a=this._collage.addPhoto(e);a.addEventListener("dragstart",this.onCollageImageDragstart.bind(this)),a.addEventListener("dragover",this.onCollageImageDragover.bind(this)),a.addEventListener("drop",this.onCollageImageDrop.bind(this)),this.updateToolbarLayouts()}},Editor.prototype.onCollageImageDragstart=function(t){var a=this,o=this._collage.getIndexOfPhoto(t.target);t.dataTransfer.setData("text/plain",o.toString());var e=t.target.style.backgroundImage.slice(-16,-2),r=this._elTrayImages.querySelector('img[src="'+e+'"]');t.dataTransfer.setDragImage(r,10,10),this._wasDraggedFromTray=!1,this._elCollageFrame.querySelectorAll(".photo").forEach(function(t){var e;a._collage.getIndexOfPhoto(t)!==o&&t.setAttribute("droppable","true")}),this._elTrayImages.setAttribute("droppable","true"),document.body.classList.add("dragging")},Editor.prototype.onCollageImageDragover=function(t){t.preventDefault(),this._wasDraggedFromTray||t.target.classList.add("active-drop-target")},Editor.prototype.onCollageImageDrop=function(t){if(t.preventDefault(),!this._wasDraggedFromTray){var e=parseInt(t.dataTransfer.getData("text/plain")),a=this._collage.getIndexOfPhoto(t.target);this._collage.swapPhotos(e,a),t.target}},Editor.prototype.onTrayDragover=function(t){t.preventDefault(),this._wasDraggedFromTray||t.target.classList.add("active-drop-target")},Editor.prototype.onTrayDrop=function(t){if(t.preventDefault(),!this._wasDraggedFromTray){var e=parseInt(t.dataTransfer.getData("text/plain"));this._collage.removePhoto(e),this.onDragend(),this.updateToolbarLayouts()}},Editor.prototype.onDragleave=function(t){t.target.classList.remove("active-drop-target")},Editor.prototype.onDragend=function(t){document.querySelectorAll(".active-drop-target").forEach(function(t){t.classList.remove("active-drop-target")}),this._elTrayImages.setAttribute("droppable","false"),this._elCollageFrame.setAttribute("droppable","false"),this._elCollageFrame.querySelectorAll(".photo").forEach(function(t){t.setAttribute("droppable","false")}),document.body.classList.remove("dragging")};